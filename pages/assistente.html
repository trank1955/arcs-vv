<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Assistente – ARCS-VV</title>
  <link rel="icon" type="image/x-icon" href="../icons/favicon.ico">
  <link rel="icon" type="image/png" href="../icons/favicon.ico">
  <link rel="shortcut icon" href="../icons/favicon.ico">
  <link rel="stylesheet" href="../main.css?v=1080">
  <style>
    .chat-wrap { max-width: 820px; margin: 90px auto 120px auto; padding: 0 1rem; }
    .chat-box { border: 1px solid #e0e0e0; border-radius: 12px; padding: 1rem; background: #fff; box-shadow: 0 2px 12px rgba(0,0,0,0.06); }
    .bubble { padding: .7rem .9rem; border-radius: 14px; margin: .4rem 0; max-width: 85%; line-height: 1.5; font-size: 1.02rem; }
    .user { background: #e3f2fd; color: #0d47a1; margin-left: auto; }
    .bot { background: #f7f1ea; color: #4e342e; }
    .chat-log { height: 50vh; min-height: 320px; overflow-y: auto; padding: .25rem; }
    .chat-input { display: flex; gap: .5rem; margin-top: .8rem; }
    .chat-input input { flex: 1; padding: .7rem .8rem; border: 1px solid #ccc; border-radius: 10px; font-size: 1rem; }
    .chat-input button { padding: .7rem 1rem; border-radius: 10px; border: none; background: var(--mobile-accent, #1565c0); color: #fff; cursor: pointer; }
    .quick { display: flex; gap: .5rem; flex-wrap: wrap; margin: .5rem 0 0 0; }
    .quick button { border: 1px solid #d8d8d8; background: #fafafa; border-radius: 999px; padding: .35rem .7rem; cursor: pointer; }
  </style>
</head>
<body class="page-assistente">
  <div id="menu-inject"></div>
  <script src="../menu.js"></script>
  <main class="chat-wrap">
    <h1 class="page-title" style="display:flex;align-items:center;gap:.5rem;">
      <img src="../icons/news-icon.svg" alt="Assistente" style="width:28px;height:28px"> Assistente
    </h1>
    <div class="chat-box">
      <div id="chatLog" class="chat-log" aria-live="polite"></div>
      <div class="quick" id="quickRow"></div>
      <div class="chat-input">
        <input id="chatInput" type="text" placeholder="Scrivi una domanda… (es. Orari punto di ascolto)" aria-label="Messaggio">
        <button id="sendBtn">Invia</button>
      </div>
    </div>
  </main>
  <script>
    // Piccola base conoscenza locale
    const kb = [
      { k: ["orari", "aperto", "apertura", "punto di ascolto"], a: "Punto di ascolto: ogni mercoledì e giovedì, 15:45 – 18:15. Sede: Parrocchia Sant'Andrea (primo piano). Vedi anche Dove siamo.", link: "dove-siamo.html" },
      { k: ["indirizzo", "sede", "via sant'andrea", "vittorio veneto"], a: "Sede ARCS-VV: Via Sant'Andrea, 37 – 31029 Vittorio Veneto (TV).", link: "dove-siamo.html" },
      { k: ["donazione", "iban", "sostegno", "bonifico"], a: "Per sostenere le attività puoi donare via bonifico. IBAN: IT21E0890462190007000008648 (Banca Prealpi SanBiagio). Dettagli nella pagina Donazioni.", link: "donazioni.html" },
      { k: ["benefici fiscali", "runts", "detraibile", "deducibile"], a: "Le donazioni a ETS/ODV/APS iscritti al RUNTS possono essere agevolate. ARCS-VV non è iscritta al RUNTS: al momento non ci sono benefici fiscali; stiamo valutando l'iscrizione.", link: "donazioni.html" },
      { k: ["iscriv", "volontar", "partecipa"], a: "Per diventare volontario compila il modulo nella pagina Iscriviti. Ti contatteremo al più presto.", link: "iscriviti.html" },
      { k: ["contatti", "telefono", "email"], a: "Contatti: arcs-vv@inventati.org • Presidente Donato Fiume: 329 986 1650.", link: "contatti.html" },
      { k: ["attività", "cosa fate", "servizi"], a: "Promuoviamo corsi di italiano, orientamento legale/linguistico, laboratori culturali e supporto psicologico.", link: "attivita.html" },
      { k: ["news", "novità", "articoli"], a: "Le ultime novità sono nella pagina News.", link: "news.html" },
      { k: ["statuto", "regole"], a: "Consulta le regole e gli scopi dell'associazione nella pagina Statuto.", link: "statuto.html" }
    ];

    const quick = [
      { t: "Orari punto ascolto", q: "Quali sono gli orari del punto di ascolto?" },
      { t: "Dove siamo", q: "Dove si trova la sede ARCS-VV?" },
      { t: "Diventa volontario", q: "Come faccio a iscrivermi come volontario?" },
      { t: "Donazioni", q: "Come posso fare una donazione?" },
      { t: "Benefici fiscali", q: "Le donazioni sono detraibili o deducibili?" },
      { t: "Contatti", q: "Quali sono i contatti dell'associazione?" },
      { t: "Attività", q: "Che attività svolgete?" },
      { t: "News", q: "Dove trovo le ultime news?" },
      { t: "Statuto", q: "Dove trovo lo statuto?" }
    ];

    const log = document.getElementById('chatLog');
    const input = document.getElementById('chatInput');
    const sendBtn = document.getElementById('sendBtn');
    const quickRow = document.getElementById('quickRow');

    function addMsg(text, who = 'bot') {
      const div = document.createElement('div');
      div.className = `bubble ${who}`;
      div.textContent = text;
      log.appendChild(div);
      log.scrollTop = log.scrollHeight;
    }

    function reply(q) {
      const ql = q.toLowerCase();
      let best = null, score = 0;
      for (const item of kb) {
        let s = 0;
        for (const kw of item.k) if (ql.includes(kw)) s++;
        if (s > score) { score = s; best = item; }
      }
      if (best && score > 0) {
        addMsg(best.a + (best.link ? `\n→ Approfondisci: ${best.link}` : ''));
      } else {
        addMsg("Posso aiutarti con orari, donazioni, iscrizioni, contatti e attività. Prova con una di queste domande o usa i pulsanti rapidi qui sopra.");
      }
    }

    function send() {
      const v = input.value.trim();
      if (!v) return;
      addMsg(v, 'user');
      input.value = '';
      setTimeout(() => reply(v), 120);
    }

    sendBtn.addEventListener('click', send);
    input.addEventListener('keydown', e => { if (e.key === 'Enter') send(); });
    // Quick buttons
    quick.forEach(({t,q}) => {
      const b = document.createElement('button');
      b.textContent = t;
      b.addEventListener('click', () => { input.value = q; send(); });
      quickRow.appendChild(b);
    });

    // Benvenuto
    addMsg("Ciao! Sono l’assistente ARCS-VV. Posso aiutarti con orari, sede, donazioni, iscrizioni, contatti e altro. Scegli un argomento o fai una domanda.");
  </script>
</body>
</html>
